```{r facets-1}
#| echo: false
source("code/before_script.R")
```

# Facets {#sec-facets}
<!-- small-multiples -->

```{r facets-2}
#| message: false
library(sf)
library(tmap)
slo_borders = read_sf("data/slovenia/slo_border.gpkg")
slo_regions = read_sf("data/slovenia/slo_regions.gpkg")
slo_regions_ts = read_sf("data/slovenia/slo_regions_ts.gpkg")
slo_regions_ts = subset(slo_regions_ts, time %in% c("2006", "2010", "2014", "2018", "2022"))
```

<!-- tm_facets() -->
<!-- two approaches -- variables (e.g., columns) vs values in one variable -->
<!-- + a mix of both approaches -->
<!-- should we limit to e.g., 5 years? -->

```{r}
#| label: fig-facets1
#| fig-cap: "Facets for different variables."
#| fig-asp: 0.5
tm_shape(slo_regions) +
  tm_polygons(c("pop_dens", "gdppercap", "tourism"))
```

```{r}
#| label: fig-facets2
#| fig-cap: "Facets for one variable over time."
#| fig-asp: 0.5
tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets(by = "time", ncol = 5)
```

```{r}
#| label: fig-facets3
#| fig-cap: "Facets for multiple variables over time."
#| fig-asp: 1
tm_shape(slo_regions_ts) +
  tm_polygons(c("pop_dens", "gdppercap", "tourism")) +
  tm_facets(by = "time")
```

<!-- customize -->
```{r}
#| label: fig-facets4
#| fig-cap: "Facets for one variable for different region groups."
tm_shape(slo_borders) +
  tm_borders() +
  tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets(by = "region_group", nrow = 2)
```

```{r}
#| label: fig-facets5
#| fig-cap: "Facets for one variable limiting the view to a specific region group."
tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets(by = "region_group", nrow = 2) +
  tm_shape(slo_borders) +
  tm_borders()
```

<!-- free.coords = FALSE) -->

```{r}
#| eval: false
#| label: fig-facets6
#| fig-cap: "Facets for one variable with free coordinates."
tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets(by = "region_group", nrow = 2, free.coords = FALSE) +
  tm_shape(slo_borders) +
  tm_borders()
```

<!-- other facets functions -->
<!-- tm_facets_wrap(by = "VARS__", nrow = NA, ncol = NA, byrow = TRUE, ...) -->
<!-- tm_facets_grid(rows = NULL, columns = NULL, pages = NULL, ...) -->

```{r facets-9}
tm_shape(slo_borders) +
  tm_borders() +
  tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets_wrap(by = "region_group", ncol = 5)
```

```{r facets-10}
tm_shape(slo_borders) +
  tm_borders() +
  tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets_grid(rows = "region_group", columns = "time")
```

<!-- tm_xlab and tm_ylab for better labels -->
```{r facets-11}
tm_shape(slo_borders) +
  tm_borders() +
  tm_shape(slo_regions_ts) +
  tm_polygons("gdppercap") +
  tm_facets_grid(rows = "region_group", columns = "time") +
  tm_xlab("Year", side = "top", size = 2, space = 1) +
  tm_ylab("Region", rotation = 90, size = 2, space = 1)
```

<!-- also: https://r-tmap.github.io/tmap/articles/adv_multivariate -->

<!-- mention the rest -->
<!-- tm_facets_stack(by = "VARS__", orientation = NA, ...) -->
<!-- tm_facets_hstack(by = "VARS__", ...) -->
<!-- tm_facets_vstack(by = "VARS__", ...) -->
<!-- tm_facets_pagewise(by = "VARS__", byrow = TRUE, ...) -->
<!-- tm_facets_flip(...) -->

<!-- Raster data -- where to add it in this section: either mix with the other content or after it -->
<!-- show how to add colors independently to each raster panel -->

```{r facets-12}
#| message: false
library(stars)
slo_tavg = read_stars("data/slovenia/slo_tavg.tif")
slo_elev = read_stars("data/slovenia/slo_elev.tif")
```

```{r facets-13}
tm_shape(slo_tavg) +
  tm_raster() +
  tm_facets(by = "band", ncol = 4)
```

```{r facets-14}
tm_shape(slo_tavg) +
  tm_raster(
    col.scale = tm_scale_continuous(values = "viridis"),
    col.legend = tm_legend(title = "Temperature (Â°C)"),
    col.free = TRUE) +
  tm_facets(by = "band", ncol = 4)
```

<!-- mixing with vector data -->

```{r facets-15}
tm_shape(slo_elev) +
  tm_raster() +
  tm_shape(slo_regions, is.main = TRUE) + 
  tm_borders() +
  tm_facets(by = "region_group", free.coords = TRUE)
```

```{r facets-16}
#| eval: false
tm_shape(slo_regions, is.main = TRUE) + 
  tm_borders() +
  tm_facets(by = "region_group", free.coords = TRUE) +
  tm_shape(slo_elev) +
  tm_raster() 
```
