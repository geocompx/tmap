{
  "hash": "594cd24eeb1e4adf8927b857e1a7c124",
  "result": {
    "engine": "knitr",
    "markdown": "::: {.cell}\n\n:::\n\n\n\n\n# Animations {#sec-animations}\n\nAnimations are a powerful way to visualize changes in data over time -- to illustrate trends, patterns, and dynamics that might not be immediately apparent in static maps.\nThey can also be used to create engaging visualizations that capture the viewer's attention or just to break the monotony of static maps, for example, by comparing different locations.\n\nIn **tmap**, animations are created by stitching together a series of static maps into a single animated image. \nThis is done with two types of functions: \n\n- `tm_animate()` and `tm_animate_fast()`, which create the animation from a **tmap** object\n- `tmap_animation()`, which saves the animation to files in formats, such as GIF and MP4\n\n## Creating animations\n\nLet's create some animations using the `slo_regions_ts` dataset, which contains various measures of Slovenian regions over time.  \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(sf)\nlibrary(tmap)\nslo_regions_ts = read_sf(\"data/slovenia/slo_regions_ts.gpkg\")\n```\n:::\n\n\n\n\nThe basis for our animations is a **tmap** object that contains the data and the way we want to visualize it.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntm = tm_shape(slo_regions_ts) +\n  tm_polygons(\"gdppercap\")\n```\n:::\n\n\n\n\n<!-- idea: animating charts along the data: -->\n<!-- tm_polygons(\"gdppercap\", fill.chart = tm_chart_donut()) -->\n\nTo make it animated, we can use the `tm_animate()` or `tm_animate_fast()` functions and specify the variable that we want to animate by, in this case, `time` (@fig-anims).\nThe difference between the two functions is that `tm_animate()` renders the animation at 2 frames per second (specified by the `fps` argument), while `tm_animate_fast()` renders it at 24 frames per second.\nThe former is more suitable for smaller datasets and cases where we want to allow the viewer to read the values on the map, while the latter is more suitable for larger datasets and cases where we want to create a smooth, cinematic animation.\n\n<!-- fix: -->\n<!-- https://github.com/r-tmap/tmap/issues/1150#issuecomment-3044249460 -->\n\n\n\n::: {#fig-anims .cell layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code}\ntm +\n  tm_animate(by = \"time\")\ntm +\n  tm_animate_fast(by = \"time\")\n```\n\n::: {.cell-output-display}\n![Using `tm_animate()`](figures/fig-anims-1.gif){#fig-anims fig-align='center' width=100%}\n:::\n\nAnimations of GDP per capita in Slovenian regions over time\n:::\n\n\n\n\nTwo main additional arguments for the *animate* functions are `fps` (frames per second) and `play` (playback mode).\nThe first one controls the speed of the animation, while the second one controls how the animation is played back: \neither `\"loop\"` (default), which plays the animation in a loop, `\"once\"`, which plays the animation only once and then stops, or `\"pingpong\"` which plays the animation back and forth (@fig-anims2).\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntm +\n  tm_animate(by = \"time\", fps = 5, play = \"pingpong\")\n```\n\n::: {.cell-output-display}\n![Animations of GDP per capita in Slovenian regions over time with a pingpong playback mode](figures/fig-anims2-1.gif){#fig-anims2 fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n<!-- https://github.com/r-tmap/tmap/issues/1160 -->\n<!-- If you read the previous chapters, you may see the similarity between the `tm_animate()` and `tm_facets()` functions, which create a series of static maps based on the values of a variable. -->\n<!-- The main difference is that `tm_animate()` creates an animation -- one frame after another -- while `tm_facets()` creates a grid of static maps, where each map corresponds to a value of the variable. -->\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\nAnimations can also be created from raster data, such as satellite imagery or climate data.\n@fig-anims3 shows an example of an animation of the average temperature in Slovenia over monthly time steps.\nFirst, the raster data is defined, and its scale is set to the continuous one.\nNext, we define the animation using `tm_animate()` and specify the `by` argument to animate by the `band` variable, which represents the time steps in the raster data.\nFinally, we add the borders of Slovenian regions to the map to provide context for the animation.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(stars)\nslo_tavg = read_stars(\"data/slovenia/slo_tavg.tif\")\nslo_regions = read_sf(\"data/slovenia/slo_regions.gpkg\")\ntm_shape(slo_tavg) +\n  tm_raster(col.scale = tm_scale_continuous()) +\n  tm_animate(by = \"band\", fps = 6) +\n  tm_shape(slo_regions) +\n  tm_borders()\n```\n\n::: {.cell-output-display}\n![Animation of average temperature in Slovenia over time](figures/fig-anims3-1.gif){#fig-anims3 fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n<!-- passing other arguments to tm_facets (+ ref) -->\n\n## Saving animations\n\nThe `tm_animate()` and `tm_animate_fast()` functions create a **tmap** object that contains the animation and shows it.\nNow, to save the animation, we can use the `tmap_animation()` function.\nIt takes the animation object as the first argument and the file name as the second argument -- the extension of the file name determines the format of the saved animation.\nWe may save the animation in either graphical format (GIF) or video format (including MP4).\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntma1 = tm +\n  tm_animate_fast(by = \"time\")\ntmap_animation(tma1, \"tma1.gif\")\n# or\n# tmap_animation(tma1, \"tma1.mp4\")\n```\n:::\n\n\n\n\nAdditionally, we can customize the output of the animation with various arguments, such as `width`, `height`, `dpi`, `asp`, and `scale` (similarly to `tmap_save()` as shown in @sec-save).\nMoreover, if the animation is saved in a video format, we can also specify various additional arguments, such as `codec` from the **av** package^[Check the documentation of the `av::av_encode_video()` function for more details.].\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}