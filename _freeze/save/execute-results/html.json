{
  "hash": "e0b3800dae3b21c3b58feaf69d74ceb6",
  "result": {
    "engine": "knitr",
    "markdown": "\n::: {.cell}\n\n:::\n\n\n# Save maps {#sec-save}\n\n\\index{saving maps}\n\\index{tmap\\_save}\nMaps created programmatically can serve several purposes, from exploratory, through visualizations of the processing steps, to being the final outputs of a given project.\nTherefore, often we want just to see our map on the screen, but sometimes we also want to save our map results to an external file.\n**tmap** objects can be directly saved to output files with `tmap_save()`^[Standard R approach of saving graphic files by opening a graphic device, e.g., `png()`, plotting the data, and then closing the device with `dev.off()` also works.].\nThe `tmap_save()` function allows to save our map in three groups of file formats: (a) raster graphics (@sec-raster-graphic-formats), (b) vector graphics (@sec-vector-graphic-formats), and (c) interactive ones (@sec-interactive-format).\n<!-- Additionally, @sec-animations shows how to save map animations with the use of the `tmap_animation()` function. -- update and add -->\n\nFor the examples in this section, we use a simple map of the Slovenia polygon with the country name superimposed <!--(not shown)-->, stored in the `tm` object.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tmap)\nlibrary(sf)\nslo_borders = read_sf(\"data/slovenia/slo_border.gpkg\")\ntm = tm_shape(slo_borders) +\n    tm_polygons() +\n    tm_text(\"Name\", fontface = \"italic\")\ntm\n```\n\n::: {.cell-output-display}\n![](figures/unnamed-chunk-2-1.png){fig-align='center' fig-pos='t' width=100%}\n:::\n:::\n\n\n## Raster graphic formats {#sec-raster-graphic-formats}\n\n\\index{raster graphics}\nRaster graphics are non-spatial relatives of spatial rasters.\nThe digital images are composed of many pixels -- squares filled with specific colors.\nMain raster graphic file formats include PNG, JPEG, and TIFF.\nPNG and JPEG are the most common formats used for saving maps, with PNG being lossless and JPEG lossy^[Tit means that PNG preserves all the information about the image when saved, while JPEG compresses the image by removing some of the information, which may result in a loss of quality.].\nThe TIFF format is lossless, storing images without quality degradation, but often resulting in large file sizes.\nPNG is generally preferred for screen and websites, while TIFF is suggested for high-resolution printing.\n\nOne of the major parameters of the raster graphic images is DPI (*Dots Per Inch*, in this context, a more proper name probably should be PPI, *Pixels Per Inch*) -- is a number of pixels per inch of the output image.\nFor example, if the width and height of our image are 10 inches, then DPI of 300 would mean that our final image would have 3000 by 3000 pixels, and DPI of 72 would result in an image of 720 by 720 pixels.\nTherefore, an image with the same width and height but a larger value of DPI would occupy more space on the hard drive but also have better quality.\n\nSaving **tmap** objects to a file can be done with the `tmap_save()`.\nIt usually accepts two arguments^[In fact, one argument is enough -- if you just provide a **tmap** object, then it is saved to a `tmap01` file with some default format.] -- the first one, `tm`, is our map object, and the second one, `filename`, is the path to the created file.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntmap_save(tm, \"my_map.png\")\n#> Map saved to my_map.png\n#> Resolution: 2503 by 1762 pixels\n#> Size: 8.34 by 5.87 inches (300 dpi)\n```\n:::\n\n\n\\index{DPI}\nBy default, DPI is set to 300, and the image width and height is automatically adjusted based on the map aspect ratio.\nThese parameters can be, however, changed with the `dpi`, `width`, and `height` arguments^[You can even specify just one of `width` or `height`, and the value of the second one will be calculated using the formula `asp = width / height`.].\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntmap_save(tm, \"my_map.png\", width = 1000, height = 750, dpi = 300)\n#> Map saved to /home/jn/Science/geocompx/tmap/my_map.png\n#> Resolution: 1000 by 750 pixels\n#> Size: 3.33 by 2.5 inches (300 dpi)\n```\n:::\n\n\nThe units of `width` or `height` depend on the value you set: they are pixels (`\"px\"`) when the value is greater than 50, and inches (`\"in\"`) otherwise.\nUnits can also be changed with the `units` argument.\n\nThe `tmap_save()` function also has several additional arguments, including `outer.margins`, `scale`, and `asp`.\nAll of them override the arguments' values set in `tm_layout()` (@sec-map-layout).\nAdditionally, when set to `0`, the `asp` argument has a side effect: it shifts the map frame to the edges of the output image.\n\n\\index{graphic device}\nBy default, **tmap** uses graphic devices^[Short discussion about graphic devices can be found in section @sec-fonts-tmap.] incorporated in R.\nHowever, it is also possible to use other, external devices with the `device` argument.\nFor example, the `ragg::agg_png` device is usually faster and has better support for non-standard fonts than the regular `grDevices::png`.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntmap_save(tm, \"my_map.png\", device = ragg::agg_png)\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n<!-- maybe a paragraph about figure sizing (interplay between width, height, dpi, and scale) and how it affects the output file size and quality? -- with a comparison of a few outputs and explanations? -->\n\n## Vector graphic formats {#sec-vector-graphic-formats}\n\n\\index{vector graphics}\nVector graphics are quite distant counterparts of spatial vectors, with vector graphics consisting of sets of coordinates.\nContrary to spatial vectors, however, their coordinates can be connected not only by straight lines (@sec-vector-data-model), but also using curves.\nThis makes it possible to create polygons, circles, ellipses, and other shapes.\nThey also allow text and other objects to be stored as vector graphics.\nCommon vector graphic file formats are EPS, PDF, and SVG.\nEPS is an older format used for printing and publishing, while PDF is a more modern, general format that can contain vector and raster graphics, and more.\nSVG is a web standard for vector graphics, which can be used in web browsers and other applications.\nIt is lightweight and allows for editing and manipulation of vector graphics.\n\nTo save a map to a vector graphic format, we still can use `tmap_save()` but either with a suitable file extension oor by explicitly setting the device argument (for example, device = `svglite::svglite`).\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntmap_save(tm, \"my_map.svg\")\n#> Map saved to /home/jn/Science/geocompx/tmap/my_map.svg\n#> Size: 8.34 by 5.87 inches\n```\n:::\n\n\nZooming in and out of vector graphics does not affect their quality.\nAt the same time, the `width,` `height,` and `scale` arguments can still impact the output file.\nFor example, a vector graphic file saved with a narrower width value has thicker lines and larger fonts than the one with a larger width value.\nYou can check this effect by saving the `tm` object with `width = 1` and then with `width = 10`.\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nCompared to raster graphics, vector graphics are not suitable for storing complex images or maps, and they are less supported by web browsers.\nThey, however, also have many advantages.\nFor example, vector graphics can also be easily edited in dedicated software (e.g., Inkscape or Adobe Illustrator), which allows for changing the style of map elements and moving them using a computer mouse outside of the R environment.\nThis approach can be useful, for example, when you want to quickly adjust the position of map elements (e.g., labels) or collaborate with a graphic designer.\nNote, however, that this process is not fully reproducible.\n\n## Interactive format {#sec-interactive-format}\n\n\\index{interactive maps}\n`tmap` map objects can not only be viewed in the interactive mode (as shown in @sec-map-modes) but also saved as HTML files by adding the `.html` extension to the output file name.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntmap_save(tm, \"my_map.html\")\n#> Interactive map saved to /home/jn/Science/geocompx/tmap/my_map.html\n```\n:::\n\n\nThe `tmap_save()` function also has several additional arguments reserved for the interactive format, including `selfcontained` and `in.iframe`.\nThe `selfcontained` argument -- `TRUE` by default -- saves our map together with additional resources (e.g., JavaScript libraries) into one HTML file. \nOtherwise, additional resources are saved in an adjacent directory.\nThe `in.iframe` argument (`FALSE` by default) allows saving an interactive map as an iframe -- when `TRUE` it creates two HTML files -- a small HTML file with the iframe container and a large one with the actual map.\n<!-- when `in.iframe = TRUE` is useful? -->\n<!-- arguments passed on to device functions or to saveWidget or saveWidgetframe -->\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n<!-- add description on scale? -->\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}